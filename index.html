<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MacroDroid Webhook Panel</title>
<style>
  body { font-family: Arial, sans-serif; padding: 2rem; background: #f0f0f0; }
  .panel { background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 0 10px #ccc; max-width: 500px; margin: auto; }
  input, button { padding: 0.6rem 1rem; width: 90%; margin: 0.5rem auto; border-radius: 4px; }
  #log { margin-top: 1rem; max-height: 150px; overflow-y: auto; font-size: 0.9rem; background: #fafafa; padding: 0.5rem; border: 1px solid #ccc; }
  .log-success { color: green; }
  .log-fail { color: red; }
</style>
</head>
<body>
  <div class="panel" id="setup-panel">
    <h2>Set Webhook URL</h2>
    <input id="webhook-url" placeholder="Enter MacroDroid webhook URL" />
    <button onclick="saveUrl()">Save URL</button>
  </div>

  <div class="panel" id="control-panel" style="display:none;">
    <h2>MacroDroid Actions</h2>
    <button onclick="trigger('action1')">Action 1</button>
    <button onclick="trigger('action2')">Action 2</button>
    <button onclick="trigger('action3')">Action 3</button>
    <button onclick="clearUrl()">Reset Webhook URL</button>
    <div id="log"></div>
  </div>

<script>
  const setupPanel = document.getElementById('setup-panel');
  const controlPanel = document.getElementById('control-panel');
  const logDiv = document.getElementById('log');

  const webhookURL = localStorage.getItem('webhookURL');
  if (webhookURL) { setupPanel.style.display = 'none'; controlPanel.style.display = 'block'; }

  function saveUrl() {
    const url = document.getElementById('webhook-url').value.trim();
    if (url) { localStorage.setItem('webhookURL', url); location.reload(); }
  }

  function clearUrl() {
    localStorage.removeItem('webhookURL'); location.reload();
  }

  async function trigger(action) {
    const base = localStorage.getItem('webhookURL');
    if (!base) return addLog('No webhook URL set!', false);
    try {
      const resp = await fetch(`${base}?action=${action}`);
      if (resp.ok) addLog(`✅ Action ${action} triggered successfully!`, true);
      else addLog(`❌ Action ${action} failed (status ${resp.status})`, false);
    } catch (e) { addLog(`❌ Error triggering action ${action}: ${e}`, false); }
  }

  function addLog(msg, success) {
    const p = document.createElement('p');
    p.textContent = msg;
    p.className = success ? 'log-success' : 'log-fail';
    logDiv.appendChild(p); logDiv.scrollTop = logDiv.scrollHeight;
  }
</script>
</body>
</html>
